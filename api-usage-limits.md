# API 请求限制规则

**创建时间**：2026-02-07
**最后更新**：2026-02-07
**用途**：NVIDIA API 使用时的请求限制参考

---

## 一、速率限制（Rate Limiting）

### 1.1 基于时间的限制

**通用规则**：
- **RPS（每秒请求数）**：免费账户通常限制在 **1-10 次/秒**
- **RPM（每分钟请求数）**：通常限制在 **60-600 次/分钟**
- **RPH（每小时请求数）**：根据账户类型和地区而异

**不同API的差异**：
- 简单的查询类API：限制较宽松（RPM可达600+）
- 复杂的推理类API：限制较严格（RPM可能只有60-100）
- 批量处理API：可能按任务数而非请求数限制

### 1.2 基于数据量的限制

- **单次请求输入大小**：通常限制在 **10MB 以下**
- **单次请求输出大小**：通常限制在 **50MB 以下**
- **总数据传输量**：按月或按天计算，超出后限制升级

### 1.3 超限处理

**响应代码**：
- HTTP 429 Too Many Requests：表示请求过多

**应对策略**：
1. **指数退避**：首次失败后等待1秒重试，失败则等待2秒、4秒、8秒...
2. **延迟发送**：使用队列机制，控制发送速率
3. **批量处理**：将多个请求合并为一个批量请求

**示例代码（Python风格）**：
```python
import time
import requests

def make_api_request(url, headers, data, max_retries=3):
    for attempt in range(max_retries):
        response = requests.post(url, headers=headers, json=data)
        
        if response.status_code == 429:
            wait_time = (2 ** attempt)  # 指数退避：1s, 2s, 4s
            time.sleep(wait_time)
            continue
        elif response.status_code == 200:
            return response.json()
        else:
            response.raise_for_status()
    
    raise Exception(f"Max retries exceeded for status 429")
```

---

## 二、并发限制

### 2.1 免费账户并发限制

| 限制类型 | 免费账户 | 企业账户 |
|---------|---------|---------|
| 单个API端点并发 | 1-5 个 | 10-50 个 |
| 总并发请求数 | 5-20 个 | 50-200 个 |
| 活跃会话数 | 1-3 个 | 10+ 个 |

### 2.2 并发管理策略

**基本原则**：
- ✅ 使用信号量（Semaphore）控制并发数
- ✅ 实现请求队列，按顺序处理
- ✅ 使用异步编程提高效率
- ❌ 避免在短时间内发送大量并发请求

**推荐实践**：
```python
import asyncio
from asyncio import Semaphore

class APIClient:
    def __init__(self, max_concurrent=5):
        self.semaphore = Semaphore(max_concurrent)
    
    async def make_request(self, url, data):
        async with self.semaphore:
            # 执行API请求
            return await self._execute_request(url, data)
    
    async def make_batch_requests(self, requests_list):
        tasks = [self.make_request(req['url'], req['data']) 
                 for req in requests_list]
        return await asyncio.gather(*tasks)
```

### 2.3 避免并发超限的方法

1. **限制同时发出的请求数**
2. **使用连接池管理**
3. **设置请求超时时间**
4. **监控活跃连接数**

---

## 三、配额管理

### 3.1 配额类型

**免费账户常见配额**：
- **每日请求配额**：通常 1,000 - 10,000 次/天
- **每月请求配额**：通常 10,000 - 100,000 次/月
- **模型使用配额**：特定模型可能有独立配额

### 3.2 配额查询方法

**方法1：Dashboard 查看**
- 访问 NVIDIA Developer Dashboard
- 查看"Usage"或"Quota"页面
- 显示当前使用量和剩余配额

**方法2：API 响应头**
- 大多数 API 在响应头中包含配额信息：
  ```
  X-RateLimit-Limit: 1000
  X-RateLimit-Remaining: 856
  X-RateLimit-Reset: 1640995200
  ```

**方法3：状态 API**
- 有些平台提供专门的配额查询端点
- 例如：`GET /api/v1/quota/status`

### 3.3 配额监控建议

**设置监控告警**：
- 当剩余配额低于 20% 时发送提醒
- 当日配额使用超过 80% 时警告
- 每周生成配额使用报告

**配额分配策略**：
1. 预留 20-30% 配额用于突发需求
2. 优先保证关键业务的配额
3. 错峰处理非紧急任务

---

## 四、配额分配策略

### 4.1 优先级分配

**高优先级**：
- 用户直接触发的请求
- 实时交互相关 API
- 关键业务逻辑

**低优先级**：
- 批量数据处理
- 后台定时任务
- 日志记录和分析

### 4.2 资源优化

**减少不必要的请求**：
- 实现本地缓存，相同请求不重复发送
- 使用增量更新而非全量查询
- 合并多个小请求为批量请求

**提高单次请求效率**：
- 一次请求获取完整数据，而非多次查询
- 使用过滤参数减少返回数据量
- 避免轮询，使用 Webhook 或回调机制

---

## 五、常见限制代码及处理

### 5.1 HTTP 状态码

| 状态码 | 含义 | 处理方法 |
|--------|------|----------|
| 200 | 成功 | 正常处理响应 |
| 400 | 请求错误 | 检查请求参数格式 |
| 401 | 未认证 | 检查 API 密钥 |
| 403 | 无权限 | 确认账户权限 |
| 429 | 请求过多 | 实施退避策略 |
| 500 | 服务器错误 | 稍后重试 |
| 503 | 服务不可用 | 等待恢复后重试 |

### 5.2 错误消息处理

**常见错误消息**：
- `"Rate limit exceeded"`：需要退避等待
- `"Quota exceeded"`：需要等待配额刷新
- `"Too many concurrent requests"`：减少并发数
- `"Token rate limit exceeded"`：认证令牌限制

---

## 六、实用检查清单

### 6.1 使用 API 前检查

- [ ] 检查当前配额剩余量
- [ ] 确认账户状态正常
- [ ] 验证 API 密钥有效性
- [ ] 准备重试机制
- [ ] 设置监控告警

### 6.2 编写代码时

- [ ] 实现指数退避重试逻辑
- [ ] 使用信号量控制并发
- [ ] 添加请求超时设置
- [ ] 记录详细的错误日志
- [ ] 设置配额使用告警

### 6.3 运行时监控

- [ ] 实时跟踪配额消耗
- [ ] 监控并发请求数
- [ ] 记录 API 响应时间
- [ ] 检测异常使用模式
- [ ] 定期生成使用报告

---

## 七、快速参考表

### 7.1 免费账户默认限制

| 项目 | 限制值 | 说明 |
|------|--------|------|
| 每秒请求数 | 1-10 RPS | 视 API 类型而定 |
| 每分钟请求数 | 60-600 RPM | 复杂 API 限制更严 |
| 每日请求数 | 1,000-10,000 | 按自然日刷新 |
| 单次输入大小 | ≤10MB | 超出可能报错 |
| 单次输出大小 | ≤50MB | 大结果可能截断 |
| 并发请求数 | ≤5-20 个 | 视具体 API 而定 |
| 活跃会话数 | ≤1-3 个 | 避免多端登录 |

### 7.2 超出限制的应对策略

| 限制类型 | 超出时的症状 | 首选解决方案 |
|---------|-------------|-------------|
| 速率限制 | HTTP 429 + "Rate limit exceeded" | 实施退避等待 |
| 配额限制 | HTTP 429 + "Quota exceeded" | 等待配额刷新 |
| 并发限制 | 连接超时或请求堆积 | 减少并发数 |
| 大小限制 | HTTP 400 + "Payload too large" | 拆分请求 |

---

## 八、注意事项

### 8.1 重要提醒

⚠️ **重要**：
1. 具体限制数值可能随时变化，使用前请查阅官方文档
2. 不同地区、不同账户类型的限制可能不同
3. 高峰期可能会有额外的临时限制
4. 企业用户可以申请更高的限制

### 8.2 最佳实践

✅ **建议做法**：
- 始终实现重试机制，包括退避策略
- 在非高峰期执行批量任务
- 预留足够的配额余量
- 定期检查和优化 API 使用

❌ **避免做法**：
- 短时间内发送大量并发请求
- 忽略 HTTP 429 错误
- 在生产环境使用接近限制的配额
- 将 API 密钥硬编码在代码中

---

## 九、官方资源

- **NVIDIA 开发者主页**：https://developer.nvidia.com/
- **NIM API 文档**：https://build.nvidia.com/docs
- **NGC 文档**：https://docs.nvidia.com/ngc/
- **状态页面**：查看服务状态和公告

---

**文档生成时间**：2026-02-07 10:29 UTC
**下次更新建议**：当 NVIDIA 官方政策变化时
